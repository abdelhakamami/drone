kind: pipeline
type: kubernetes
name: default

steps:
- name: greeting
  image: alpine
  commands:
  - echo hello
- name: deploy
  image: bitnami/git:latest 
  commands:

    - git clone https://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@github.com/abdelhakamami/devops.git
    - git clone https://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@github.com/abdelhakamami/electionApp.git
    - cd electionApp && old=$(git rev-parse HEAD | cut -c 1-7
    
    - cd ..
    - cd devops/apps/election-app/
    - sed -i "s/$old/dev/g" kustomization.yaml 
    - git add . && git commit -m  "abc" && git push

    
    

    
  
