kind: pipeline
type: kubernetes
name: default

steps:
- name: greeting
  image: alpine
  commands:
  - echo hello
- name: deploy
  image: alpine/git:2.36.3 
  environment:
      GIT_PASSWORD: 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
  commands:
    - git config --global --add url."git@github.com:".insteadOf "https://github.com/"

    - git config --global user.email "abdelhakamami@gmail.com"
    #- git config --global user.name "abdelhakamami"
    - git config --global user.password "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"
    - git config --global credential.helper store

    - git clone https://github.com/abdelhakamami/devops.git
    - git clone https://github.com/abdelhakamami/electionApp.git
    - cd electionApp && old=$(git rev-parse HEAD | cut -c 1-7)
    
    - cd ..
    - cd devops/apps/election-app/
    - sed -i 's/dev/abc/g' kustomization.yaml 
    - git add . && git commit -m  "abc" && git push origin main #https://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@github.com/abdelhakamami/devops.git
    
    

    
  
