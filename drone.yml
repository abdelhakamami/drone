kind: pipeline
name: remove-images
type: kubernetes 
steps:
  - name: remove-images
    image: docker:20.10-dind
    volumes:
      - name: dockersock
        path: /var/run/docker.sock
    environment:
       UNAME: abdelhakavaxia
       TOKEN: dckr_pat_nmj1n6g5nQF07n7w5VHVaYsanTI
       REPO: abdelhakavaxia/election-app-front-end
    commands:
      - apk add --update curl jq

      - docker login -u $UNAME -p $TOKEN
      - chmod 600 ./remove_images.sh
      - ./remove_images.sh
    volumes:
      - name: dockersock
        hostPath:
          path: /var/run/docker.sock
